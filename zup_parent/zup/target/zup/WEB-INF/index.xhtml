<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>Virtual Library</title>
    <script src="../bootstrap/js/jquery-1.10.2.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"/>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"/>
  	<script src="../bootstrap/js/bootstrap.min.js"></script>
  	<script>
  //<![CDATA[
  	$(document).ready(function(){

  		$.ajax({
			   url: 'http://localhost:8080/app/zup/listaprodutos',
			   dataType: 'json',
			   success: function(data) {
			   		for (var i = 0; i < data.length ; i++) {
		                 tr = $('<tr/>');
		                 tr.append("<td>" + data[i].id + "</td>");
		                 tr.append("<td style='cursor: pointer;'>" + data[i].name + "</td>");
		                 tr.append("<td style='cursor: pointer;'>" + data[i].description + "</td>");
		                 tr.append("<td style='cursor: pointer;'>" + data[i].price + "</td>");
		                 tr.append("<td style='cursor: pointer;'>" + data[i].category + "</td>");
		                 tr.append("<td><button type='button' class='btn btn-info' onclick='abreEdicao(\""+data[i].id+"\", \""+data[i].name+"\", \""+data[i].description+"\", \""+data[i].price+"\", \""+data[i].category+"\")'>Editar</button>"+
		                		 "  <button type='button' class='btn btn-success' onclick='recuperar(\""+data[i].id+"\")'>Recuperar</button>"+
		                		 "  <button type='button' class='btn btn-danger' onclick='excluir(\""+data[i].id+"\")'>Excluir</button></td>");
		                 $('#produtos').append(tr);
		             }
			   },
			});
	 });
  	
  	function excluir(id){
  		var urlDelete = 'http://localhost:8080/app/zup/delete/'+id;
  		$.ajax({url: urlDelete, type: 'DELETE', success: function(result){
  			window.location.replace("http://localhost:8080/app/zup/index.xhtml");
  			alert("Excluido com sucesso");
  	    }});  		
  	}
  	
  	function abreEdicao(id, name, description, price, category){
  		$("#id").val(id);
  		$("#name").val(name);
  		$("#description").val(description);
  		$("#price").val(price);
  		$("#category").val(category);
  		$("#edicaoProduto").modal();
  	}
  	
  	function edita(){
  		var urlEdita = 'http://localhost:8080/app/zup/edita/'+$('#id').val()+'/'+$('#name').val()+'/'+$('#description').val()+'/'+$('#price').val()+'/'+$('#category').val();
		$.ajax({url: urlEdita, type: 'PUT', success: function(result){
  			window.location.replace("http://localhost:8080/app/zup/index.xhtml");
  			alert("Atualizado com sucesso");
  	    }});  
  	}
  	
  	function recuperar(id){
  		var urlrecupera = 'http://localhost:8080/app/zup/recupera/'+id;
		$.ajax({
		   url: urlrecupera,
		   dataType: 'json',
		   type: 'GET',
		   success: function(data) {
			   	$("#idProduct").val(data.id);
		  		$("#nameProduct").val(data.name);
		  		$("#descriptionProduct").val(data.description);
		  		$("#priceProduct").val(data.price);
		  		$("#categoryProduct").val(data.category);
		  		$("#recuperaProduto").modal();
		   },
		 });
		
  	}
  	
  	function inserir(){
  		
  		var urlInsere = 'http://localhost:8080/app/zup/insere/'+$('#nameNewProduct').val()+'/'+$('#descriptionNewProduct').val()+'/'+$('#priceNewProduct').val()+'/'+$('#categoryNewProduct').val();
		$.ajax({
		   url: urlInsere,
		   type: 'POST',
		   dataType: 'json',
		   success: function(data) {
			   window.location.replace("http://localhost:8080/app/zup/index.xhtml");  	
			   alert('Produto cadastrado com sucesso');
		   },
		   error: function() {
			   	$("#nameNewProduct").val('');
		  		$("#descriptionNewProduct").val('');
		  		$("#priceNewProduct").val('');
		  		$("#categoryNewProduct").val('');
	            alert('Erro ao inserir, todos campos devem informados e o campo price deve ser numerico');
	       }
		 });
		
  	}
  
  	function abreTelaInserir(){
  		
  		$("#insereProduto").modal();
  		
  	}
  	
  	
  //]]> 
    </script>
  	
  </head>
  
	<body>

	<div>
	
		<nav class="navbar navbar-default navbar-fixed-top">
			<div class="container">
				<button type="button" class="btn btn-default navbar-btn" onclick="abreTelaInserir()">Inserir</button>
			</div>
		</nav>
		
		<div class="container">
		  <h2></h2>
		  <p>Lista de produtos cadastrados</p>    
		  <table data-toggle="table" class="table table-striped" id="produtos">
		    <thead>
		        <tr>
		            <th data-field="Id">index</th>
		            <th data-field="Name">name</th>
		            <th data-field="Description">description</th>
		            <th data-field="Price">price</th>
		            <th data-field="Category">category</th>
		            <th data-field="Action">action</th>
		        </tr>
		    </thead>
			</table>
		</div>
		
		<div class="modal fade" id="edicaoProduto" role="dialog">
		    <div class="modal-dialog">
		    
		      <div class="modal-content">
		        <div class="modal-header">
		          <button type="button" class="close" data-dismiss="modal">&times;</button>
		          <h4 class="modal-title">Editar Produto</h4>
		        </div>
		        <div class="modal-body">  
		        	<h4>Id</h4>
					<input type="text" class="form-control disabled" id="id" disabled="disabled"/>
					<h4>Name</h4>
					<input type="text" class="form-control" id="name"/>
					<h4>Description</h4>
					<input type="text" class="form-control" id="description"/>
					<h4>Price</h4>
					<input type="text" class="form-control" id="price"/>
					<h4>Category</h4>
					<input type="text" class="form-control" id="category"/>
		        </div>
		        <div class="modal-footer">
		          <button type="button" class="btn btn-default" data-dismiss="modal" onclick="edita()">Update</button>
		        </div>
		      </div>
		      
		    </div>
	  	</div>
	  	
	  	<div class="modal fade" id="recuperaProduto" role="dialog">
		    <div class="modal-dialog">
		    
		      <div class="modal-content">
		        <div class="modal-header">
		          <button type="button" class="close" data-dismiss="modal">&times;</button>
		          <h4 class="modal-title">Consulta Produto</h4>
		        </div>
		        <div class="modal-body">  
		        	<h4>Id</h4>
					<input type="text" class="form-control disabled" id="idProduct" disabled="disabled"/>
					<h4>Name</h4>
					<input type="text" class="form-control" id="nameProduct" disabled="disabled"/>
					<h4>Description</h4>
					<input type="text" class="form-control" id="descriptionProduct" disabled="disabled"/>
					<h4>Price</h4>
					<input type="text" class="form-control" id="priceProduct" disabled="disabled"/>
					<h4>Category</h4>
					<input type="text" class="form-control" id="categoryProduct" disabled="disabled"/>
		        </div>
		        <div class="modal-footer">
		          <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
		        </div>
		      </div>
		      
		    </div>
	  	</div>
	  	
	  	<div class="modal fade" id="insereProduto" role="dialog">
		    <div class="modal-dialog">
		    
		      <div class="modal-content">
		        <div class="modal-header">
		          <button type="button" class="close" data-dismiss="modal">&times;</button>
		          <h4 class="modal-title">Inserir Produto</h4>
		        </div>
		        <div class="modal-body">  
					<h4>Name</h4>
					<input type="text" class="form-control" id="nameNewProduct"/>
					<h4>Description</h4>
					<input type="text" class="form-control" id="descriptionNewProduct"/>
					<h4>Price</h4>
					<input type="text" class="form-control" id="priceNewProduct"/>
					<h4>Category</h4>
					<input type="text" class="form-control" id="categoryNewProduct"/>
		        </div>
		        <div class="modal-footer">
		          <button type="button" class="btn btn-default" data-dismiss="modal" onclick="inserir()">Inserir</button>
		        </div>
		      </div>
		      
		    </div>
	  	</div>
		
	</div>

	</body>

</html>